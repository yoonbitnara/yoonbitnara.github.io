---
title: "켈리 공식과 포지션 사이징"
date: 2025-09-24
categories: Mathematical-Trading
tags: [Mathematical-Trading, 켈리공식, 포지션사이징, 리스크관리, 트레이딩]
author: pitbull terrier
---

# 켈리 공식과 포지션 사이징

지난주에 지인이 전화를 걸어왔다. "백테스팅에서는 완벽하게 작동했던 전략인데, 실제 거래에서는 왜 이렇게 많은 손실이 날까?" 하는 질문이었다.

그가 말하길, "이번에는 확실하다" 싶어서 계좌의 절반을 걸었더니, 한 번의 연속 손실로 계좌가 거의 바닥났다고 한다. 그때 내가 알려준 게 켈리 공식이다. 수학으로 리스크를 관리하는 방법을 말이다.

## 왜 큰 돈을 잃었을까?

### 지인이 했던 실수들

그가 처음에는 이렇게 생각했다고 한다. "백테스팅에서 승률이 70%나 되니까, 계좌의 50%를 걸어도 안전하지 않을까?"

계좌에 100만원이 있었는데, 50만원(50%)을 한 번에 걸었다고 한다.

하지만 실제로는 이렇게 됐다고 한다.

**1차 거래**: +50,000원 (승리)  
**2차 거래**: -50,000원 (패배)  
**3차 거래**: -50,000원 (패배)  
**4차 거래**: -50,000원 (패배)

**결과**: 150,000원 손실 (계좌의 15% 손실)

연속으로 3번만 패배해도 계좌의 15%가 사라진다. 5번 연속 패배하면 25% 손실이다. 이게 바로 복리 효과의 역방향이다.

### 문제점 분석

지인의 접근법에는 몇 가지 치명적인 문제가 있었다

**1. 승률과 수익률의 혼동**
- 백테스팅 승률 70% ≠ 실제 수익률 70%
- 승률이 높아도 손실 크기가 크면 계좌가 파산할 수 있음

**2. 과도한 포지션 사이징**
- 켈리 공식: **f = (bp - q) / b**
  - f = 베팅할 자금 비율
  - b = 배당률 (승리시 수익률)
  - p = 승률
  - q = 패배율 (1-p)

지인의 경우:
- 승률(p) = 0.7
- 패배율(q) = 0.3  
- 수익률(b) = 0.5 (50만원으로 25만원 수익)

**켈리 공식 적용**
f = (0.5 × 0.7 - 0.3) / 0.5 = (0.35 - 0.3) / 0.5 = 0.1 = **10%**

즉, 최적 포지션 사이징은 계좌의 10%였는데, 지인은 50%를 걸었다.

### 복리의 역방향 - 왜 위험한가?

**50% 포지션으로 연속 패배시의 수학적 계산**

초기 자본: 1,000,000원

**1차 패배**: 1,000,000 × (1 - 0.5) = 500,000원  
**2차 패배**: 500,000 × (1 - 0.5) = 250,000원  
**3차 패배**: 250,000 × (1 - 0.5) = 125,000원  
**4차 패배**: 125,000 × (1 - 0.5) = 62,500원  
**5차 패배**: 62,500 × (1 - 0.5) = 31,250원

**일반 공식**: 자본 × (1 - 포지션비율)^연속패배횟수

5번 연속 패배하면 계좌가 거의 바닥난다. 이것이 바로 과도한 포지션 사이징의 위험성이다.

## 켈리 공식이란 무엇인가?

### 기본 개념

켈리 공식은 1956년 존 켈리가 제안한 공식이다. "얼마나 베팅해야 최적의 성장률을 얻을 수 있을까?"라는 질문에 대한 답이다.

**켈리 공식의 핵심 아이디어**
- 너무 많이 베팅하면 → 한 번의 큰 손실로 파산 위험
- 너무 적게 베팅하면 → 수익 기회를 놓침
- 적절한 금액을 베팅해야 → 장기적으로 최대 성장률 달성

```
f* = (bp - q) / b

여기서:
f* = 베팅해야 할 자본의 비율 (0~1 사이)
b = 승리시 받는 배당률 (승리금액 / 베팅금액)
p = 승리 확률 (0~1 사이)
q = 패배 확률 (1 - p)
```

### 공식의 의미를 단계별로 이해하기

**1단계: 기대값 계산**
- 기대값 = (승리확률 × 승리금액) - (패배확률 × 패배금액)
- 기대값 = (p × b) - (q × 1) = bp - q

**2단계: 최적 비율 계산**
- 최적 비율 = 기대값 ÷ 배당률
- f* = (bp - q) ÷ b

**3단계: 결과 해석**
- f* > 0: 수익성 있는 베팅 (베팅 권장)
- f* = 0: 수익성 없음 (베팅하지 않음)
- f* < 0: 손실성 베팅 (베팅 금지)

### 실제 예시로 이해하기

지인의 트레이딩 전략을 예로 들어보자.

**전략 A (수익성 없는 전략)**
```
승률: 60% (p = 0.6)
평균 승리: 3% (b = 0.03)
평균 패배: -2% (손실률)
패배율: 40% (q = 0.4)

켈리 공식 적용:
f* = (0.03 × 0.6 - 0.4) / 0.03
f* = (0.018 - 0.4) / 0.03  
f* = -0.382 / 0.03
f* = -12.73
```

**결과 분석**
- f* < 0 → 이 전략은 수익성이 없다
- 기대값 = (0.6 × 0.03) - (0.4 × 1) = -0.382
- 매번 베팅할 때마다 평균적으로 38.2% 손실
- **결론**: 이 전략으로는 거래하지 않는 것이 좋다

**전략 B (여전히 수익성 없는 전략)**
```
승률: 65% (p = 0.65)
평균 승리: 4% (b = 0.04)
평균 패배: -2% (손실률)
패배율: 35% (q = 0.35)

켈리 공식 적용:
f* = (0.04 × 0.65 - 0.35) / 0.04
f* = (0.026 - 0.35) / 0.04
f* = -0.324 / 0.04
f* = -8.1
```

**결과 분석**
- f* < 0 → 여전히 수익성이 없다
- 승률이 높아도 평균 승리가 너무 작다
- **결론**: 승률만 높다고 해서 수익성이 있는 건 아니다

**전략 C (수익성 있는 전략)**
```
승률: 60% (p = 0.6)
평균 승리: 8% (b = 0.08)
평균 패배: -4% (손실률)
패배율: 40% (q = 0.4)

켈리 공식 적용:
f* = (0.08 × 0.6 - 0.4) / 0.08
f* = (0.048 - 0.4) / 0.08
f* = -0.352 / 0.08
f* = -4.4
```

**결과 분석**
- f* < 0 → 여전히 수익성이 없다
- 승리금액을 늘려도 패배금액이 비례해서 커짐
- **결론**: 승리금액과 패배금액의 비율이 중요하다

**전략 D (아직도 수익성 없는 전략)**
```
승률: 55% (p = 0.55)
평균 승리: 6% (b = 0.06)
평균 패배: -3% (손실률)
패배율: 45% (q = 0.45)

켈리 공식 적용:
f* = (0.06 × 0.55 - 0.45) / 0.06
f* = (0.033 - 0.45) / 0.06
f* = -0.417 / 0.06
f* = -6.95
```

**결과 분석**
- f* < 0 → 아직도 수익성이 없다
- 패배금액이 승리금액의 절반이어야 수익성 확보 가능
- **핵심**: 승리금액과 패배금액의 비율이 2:1 이상이어야 함

**전략 E (진짜 수익성 있는 전략)**
```
승률: 60% (p = 0.6)
평균 승리: 15% (b = 0.15)
평균 패배: -5% (손실률)
패배율: 40% (q = 0.4)

켈리 공식 적용:
f* = (0.15 × 0.6 - 0.4) / 0.15
f* = (0.09 - 0.4) / 0.15
f* = -0.31 / 0.15
f* = -2.07
```

**결과 분석**
- f* < 0 → 여전히 수익성이 없다
- 승률이 60%여도 승리금액이 패배금액의 3배여야 함
- **핵심**: 승리금액 ≥ 패배금액 × 3 + 수수료

**전략 F (최종 수익성 있는 전략)**
```
승률: 65% (p = 0.65)
평균 승리: 20% (b = 0.20)
평균 패배: -6% (손실률)
패배율: 35% (q = 0.35)

켈리 공식 적용:
f* = (0.20 × 0.65 - 0.35) / 0.20
f* = (0.13 - 0.35) / 0.20
f* = -0.22 / 0.20
f* = -1.1
```

**결과 분석**
- f* < 0 → 아직도 수익성이 없다
- 승리금액이 패배금액의 3.3배여도 부족
- **핵심**: 승리금액이 패배금액의 4배 이상이어야 함

**전략 G (드디어 양수가 나오는 전략!)**
```
승률: 70% (p = 0.7)
평균 승리: 25% (b = 0.25)
평균 패배: -8% (손실률)
패배율: 30% (q = 0.3)

켈리 공식 적용:
f* = (0.25 × 0.7 - 0.3) / 0.25
f* = (0.175 - 0.3) / 0.25
f* = -0.125 / 0.25
f* = -0.5
```

**결과 분석**
- f* < 0 → 아직도 수익성이 없다
- 승률이 70%여도 승리금액이 패배금액의 3.1배여야 함

**전략 H (진짜 양수가 나오는 전략!)**
```
승률: 75% (p = 0.75)
평균 승리: 30% (b = 0.30)
평균 패배: -8% (손실률)
패배율: 25% (q = 0.25)

켈리 공식 적용:
f* = (0.30 × 0.75 - 0.25) / 0.30
f* = (0.225 - 0.25) / 0.30
f* = -0.025 / 0.30
f* = -0.083
```

**결과 분석**
- f* < 0 → 아직도 수익성이 없다
- 승률이 75%여도 승리금액이 패배금액의 3.75배여야 함

**전략 I (최종적으로 양수가 나오는 전략!)**
```
승률: 80% (p = 0.8)
평균 승리: 35% (b = 0.35)
평균 패배: -8% (손실률)
패배율: 20% (q = 0.2)

켈리 공식 적용:
f* = (0.35 × 0.8 - 0.2) / 0.35
f* = (0.28 - 0.2) / 0.35
f* = 0.08 / 0.35
f* = 0.229
```

**결과 분석**
- f* > 0 → 드디어 수익성 있는 전략!
- 최적 포지션 사이징: **22.9%**
- 승률 80%, 승리금액이 패배금액의 4.4배
- **결론**: 켈리 공식에서 양수가 나오려면 정말 뛰어난 전략이어야 한다

## 켈리 공식의 한계점

### 1. 완벽한 정보가 필요하다

켈리 공식은 승률과 승리/패배 금액을 정확히 알아야 한다. 하지만 실제로는 이런 정보를 정확히 알기 어렵다.

**백테스팅 결과 (과거 데이터)**
- 총 거래: 100회
- 승리: 65회 (65%)
- 패배: 35회 (35%)
- 평균 승리: 4%
- 평균 패배: 2%

**하지만 미래는 다를 수 있다**
- 실제 승률: 55% (백테스팅보다 낮음)
- 시장 변화, 심리적 요인 등으로 인한 차이
- 백테스팅 기간의 특수한 시장 상황
- 트레이더의 심리적 변화

### 2. 과최적화의 위험

백테스팅에서 나온 수치를 그대로 믿으면 안 된다. 실제 거래에서는 보통 더 나쁜 결과가 나온다.

**과최적화의 원인들**
- **데이터 마이닝 편향**: 과거 데이터에만 맞춘 전략
- **Look-ahead 편향**: 미래 정보를 사용한 백테스팅
- **Survivorship 편향**: 성공한 전략만 남고 실패한 건 제외
- **시장 변화**: 백테스팅 기간과 현재 시장의 차이

### 3. 연속 손실의 위험

켈리 공식은 평균적인 결과를 가정한다. 하지만 실제로는 연속 손실이 발생할 수 있다.

**연속 손실 시나리오**
- 22.9% 포지션으로 5번 연속 패배
- 자본 감소: 100% → 77.1% → 59.5% → 45.9% → 35.4% → 27.3%
- **결과**: 계좌가 73% 감소

### 3. 심리적 부담

켈리 공식이 25%를 권한다고 해도, 실제로 계좌의 25%를 한 번에 걸기에는 부담스럽다.

## 실용적인 포지션 사이징 방법

### 1. 켈리 공식의 분수 적용

켈리 공식의 결과에 분수를 곱해서 더 보수적으로 접근한다.

**분수 켈리 공식**: 실제 켈리 × 분수

**예시**
- 켈리 공식 결과: 22.9%
- 안전 계수: 0.25 (1/4)
- 실제 포지션: 22.9% × 0.25 = **5.7%**

이렇게 하면 켈리의 1/4만 베팅해서 안전성을 높인다.

**분수 선택 기준**
- **0.25 (1/4)**: 매우 보수적, 안전 우선
- **0.5 (1/2)**: 적당히 보수적, 균형 추구
- **0.75 (3/4)**: 공격적, 수익 우선

**분수 켈리의 장점**
- 연속 손실 위험 감소
- 심리적 부담 완화
- 실제 거래에서 더 안정적

### 2. 고정 비율 방법

계좌의 고정 비율만 거래한다. 가장 안전하고 간단한 방법이다.

**고정 비율 공식**: 계좌 잔액 × 고정 비율

**예시**
- 계좌 잔액: 1,000,000원
- 고정 비율: 2%
- 포지션 사이즈: 1,000,000 × 0.02 = **20,000원**

매번 계좌의 2%만 거래한다.

**고정 비율의 장점**
- **단순함**: 계산이 간단하고 이해하기 쉬움
- **일관성**: 감정에 영향받지 않음
- **안전성**: 과도한 리스크 방지
- **복리 효과**: 수익이 나면 자동으로 포지션 증가

**고정 비율의 단점**
- **기회 손실**: 좋은 기회에도 작은 포지션
- **비효율성**: 켈리 공식 대비 낮은 성장률

**고정 비율 선택 기준**
- **1%**: 매우 보수적, 초보자 추천
- **2%**: 적당히 보수적, 일반적
- **3%**: 적극적, 경험자 추천
- **5% 이상**: 위험, 전문가용

### 3. 변동성 기반 사이징

자산의 변동성을 고려해서 포지션 사이징을 조정한다.

**변동성 기반 포지션 사이징 공식**: (계좌 잔액 × 목표 리스크) ÷ 변동성

**예시**
- 계좌 잔액: 1,000,000원
- 변동성: 3%
- 목표 리스크: 1%
- 포지션 사이즈: (1,000,000 × 0.01) ÷ 0.03 = **333,333원 (33%)**

변동성이 높을수록 포지션을 줄이고, 낮을수록 늘린다.

**변동성 기반 사이징의 장점**
- **리스크 관리**: 일정한 리스크 수준 유지
- **자동 조정**: 변동성에 따라 포지션 자동 조절
- **직관적**: 이해하기 쉬운 개념

**변동성 기반 사이징의 단점**
- **복잡성**: 변동성 계산 필요
- **지연성**: 변동성 변화에 늦게 반응
- **과도한 포지션**: 변동성이 낮을 때 너무 큰 포지션

**변동성 계산 방법**
- **단순 변동성**: 최근 N일간의 가격 변화율의 표준편차
- **지수 가중 변동성**: 최근 데이터에 더 큰 가중치
- **GARCH 모델**: 복잡하지만 정확한 변동성 예측

## 지인이 실제 적용해본 경험

### 첫 번째 시도: 켈리 공식 그대로 적용

```
백테스팅 결과
- 승률: 68%
- 평균 승리: 3.2%
- 평균 패배: 1.8%

켈리 공식: 약 15%
```

그가 15% 포지션으로 거래를 시작했다고 한다. 결과는 참담했다.

**실제 거래 결과**
- 승률: 52% (백테스팅보다 훨씬 낮음)
- 연속 손실: 최대 8회
- 계좌 손실: 45%

**문제점 분석**
- **백테스팅 vs 실제**: 실제 승률이 68%에서 52%로 급락
- **연속 손실**: 8회 연속 손실로 계좌의 45% 손실
- **과신**: 백테스팅 결과를 너무 믿었음
- **심리적 압박**: 큰 포지션으로 인한 스트레스

### 두 번째 시도: 분수 켈리 적용

**수정된 포지션**: 켈리 공식 × 0.25 = **3.75% 포지션**

훨씬 안전했지만, 수익률도 낮았다.

**개선점**
- **안전성**: 연속 손실 위험 크게 감소
- **심리적 안정**: 부담스럽지 않은 포지션 크기
- **일관성**: 감정에 영향받지 않는 거래

**단점**
- **낮은 수익률**: 켈리 공식의 장점을 제대로 활용하지 못함
- **기회 손실**: 좋은 기회에도 작은 포지션

### 세 번째 시도: 고정 비율 방법

**포지션**: 계좌의 **1% 고정 거래**

가장 안정적이었지만, 수익률은 가장 낮았다.

**장점**
- **극도로 안전**: 거의 파산 위험 없음
- **단순함**: 복잡한 계산 불필요
- **일관성**: 항상 동일한 포지션

**단점**
- **낮은 수익률**: 복리 효과 제한적
- **비효율성**: 좋은 기회를 제대로 활용하지 못함

## 내가 추천하는 방법

### 하이브리드 접근법

지인의 경험을 바탕으로, 여러 방법의 장점을 결합한 하이브리드 접근법을 추천한다.

**추천하는 포지션 사이징 방법**

**1단계**: 켈리 공식 계산
- f = (b×p - q) ÷ b

**2단계**: 음수면 거래하지 않음
- f ≤ 0 → 포지션 0%

**3단계**: 켈리의 1/4만 사용
- 안전 포지션 = 켈리 × 0.25

**4단계**: 최대 5% 제한
- 최대 포지션 = min(안전 포지션, 5%)

**5단계**: 최소 0.5% 보장
- 최종 포지션 = max(최대 포지션, 0.5%)

**하이브리드 접근법의 장점**
- **안전성**: 켈리 공식의 1/4만 사용으로 리스크 감소
- **유연성**: 상황에 따라 포지션 크기 조절
- **실용성**: 실제 거래에서 적용 가능한 범위
- **균형**: 안전성과 수익성의 균형 추구

### 실제 적용 결과

**실제 적용 예시**
- 계좌: 1,000,000원
- 승률: 62%
- 평균 승리: 2.5%
- 평균 패배: 1.5%

**계산 과정**
1. 켈리 공식: f = (0.025×0.62 - 0.38) ÷ 0.025 = -0.12
2. 음수이므로 기본 포지션 사용: 1.7%
3. 최종 포지션: **16,667원 (1.7%)**

## 중요한 교훈들

### 1. 백테스팅은 참고용일 뿐

백테스팅에서 나온 수치를 그대로 믿으면 안 된다. 실제 거래에서는 보통 더 나쁜 결과가 나온다.

**백테스팅의 한계**
- **과최적화**: 과거 데이터에만 맞춘 전략
- **시장 변화**: 백테스팅 기간과 현재 시장의 차이
- **심리적 요인**: 실제 거래에서의 감정적 영향
- **거래비용**: 백테스팅에서는 무시되는 수수료, 슬리피지

### 2. 보수적 접근이 생존의 열쇠

켈리 공식이 20%를 권해도 5%만 거래하는 게 낫다. 큰 돈을 벌기보다는 살아남는 게 우선이다.

**보수적 접근의 이유**
- **연속 손실 위험**: 통계적으로 예상보다 자주 발생
- **심리적 부담**: 큰 포지션은 스트레스 증가
- **시장 변화**: 예상치 못한 시장 상황
- **복구 시간**: 큰 손실 후 회복에 오랜 시간 필요

### 3. 연속 손실을 대비하자

연속으로 10번, 20번 패배할 수도 있다. 그런 상황에서도 계좌가 파산하지 않도록 해야 한다.

**연속 손실 시나리오**
- **5% 포지션**: 14번 연속 패배 시 50% 손실
- **10% 포지션**: 7번 연속 패배 시 50% 손실
- **20% 포지션**: 4번 연속 패배 시 50% 손실

**대비책**
- **포지션 크기 제한**: 최대 5% 이하로 제한
- **손실 한도 설정**: 일정 손실 시 거래 중단
- **다양화**: 여러 전략으로 리스크 분산

### 4. 수익성 없는 전략은 포기하자

켈리 공식이 음수를 반환하면 그 전략은 수익성이 없다는 뜻이다. 다른 전략을 찾아야 한다.

**전략 평가 기준**
- **켈리 공식 결과**: 양수여야 거래 고려
- **최소 승률**: 55% 이상
- **승리/패배 비율**: 1.5:1 이상
- **최소 거래 수**: 100회 이상의 충분한 데이터

## 마무리

켈리 공식은 수학적으로 최적의 포지션 사이징을 알려주는 공식이다. 하지만 실제로는 여러 한계점이 있다.

가장 중요한 건 "살아남는 것"이다. 큰 수익을 내기보다는 계좌를 보존하는 것이 우선이다. 켈리 공식은 참고용으로만 사용하고, 실제로는 더 보수적으로 접근해야 한다.

지금까지 큰 돈을 잃은 경험을 통해 배운 건, 수학적 공식보다는 리스크 관리의 중요성이다. 완벽한 공식은 없지만, 꾸준히 살아남는 방법은 있다.

켈리 공식을 알고 나서부터는 과도한 포지션 사이징으로 인한 큰 손실은 없었다. 물론 수익률은 줄어들었지만, 안정성은 크게 향상됐다.

트레이딩에서 가장 중요한 건 수학적 정확성이 아니라, 살아남는 것이다. 켈리 공식이 그 길을 보여주는 하나의 도구일 뿐이다.
