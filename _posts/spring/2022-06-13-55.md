---
title: "스프링으로 쇼핑몰을 만들어보자4 - 인증번호 이메일 전송"
tags: 스프링쇼핑몰
date: "2022.06.13"
categories: 
    - Spring
---

## 기능구현
- 회원가입(주소API연동, 이메일 인증, ajax를 사용하여 아이디 중복검사)
- 관리자 페이지(인터셉터 적용, 상품관리, 회원관리)
- 업로드(이미지 등록, 수정, 삭제)
- 검색
- 페이징
- 구매(장바구니, 포인트사용)
- 댓글(등록,수정,삭제)
- 중간에 막혔거나 에러 해결 못하겠으면 yoonbitnara@gmail.com 으로 문의

<br>

## 목차
- 이메일 전송 환경 세팅
- 인증번호 입력란 색상 변경 및 disabled 속성 추가
- 이메일 전송 메서드 추가
- Controller 메서드 추가
- 테스트

<br>

## join.jsp

<br>

```jsp
<div class="mail_wrap">
				<div class="mail_name">이메일</div> 
				<div class="mail_input_box">
					<input class="mail_input" name="memberMail">
				</div>
```

- `<div class = 'mail_wrap>'`클래스 이름을 `mail_check_wrap`로 바꿔준다.

<br>

```jsp
<div class="mail_check_wrap">
				<div class="mail_name">이메일</div> 
				<div class="mail_input_box">
					<input class="mail_input" name="memberMail">
				</div>
```

<br>

## SMTP Server를 이용한 메일전송(세팅)
- SMTP는 Simple Mail Transfer Protocol의 약자이며 전자 메일 전송을 위한 표준 프로토콜이다.
- 메일 서버는 SMTP Server, POP3 Server가 있고 POP3 Server는 이메일을 수신하는 서버이다.
- 메일 전송 기능을 구현하기 위해선 아래의 4가지가 필요하다.
	- pom.xml 설정
	- mailSender Bean등록(`root-context.xml` or `servlet-context.xml`)
	- Controller 메서드 추가
	- 메일 계정 보안 설정
- 메일서버(SMTP Server)를 통해 메일을 전송할 때 두가지 방법이 있다.
	- **메일서버가 릴레이를 허용하는 경우**
		- 계정이 존재하지 않더라도 메일을 발송할 수 있다.
		- 릴레이를 허용하는 경우 잘못된 방식으로 악용될 수 있다.
		- 특정 IP에서만 릴레이가 되도록 하는게 일반적이다.
		- 릴레이란?
			- 외부에서 해당 메일서버를 경유해서 외부로 메일을 보내는 것을 의미한다.
	- **메일서버에 계정 인증 후 메일을 전송하는 방법**

<br>

## 구글 세팅

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FOa7Uw%2FbtqHhQbMNPE%2FxSUb3JstCwWsmsLOWU61YK%2Fimg.png)

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbapziN%2FbtqHlVjkcrE%2Fw1csQBDXN3TKC2qlZZE3nk%2Fimg.png)

<br>


![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FWsDNk%2FbtqHnkJYE4j%2FxENzIsYxk2oKK4EwfFJ3s1%2Fimg.png)

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdY28Ri%2FbtqHiNNcRzw%2FzcESospKcaBtNRX9yqk9Zk%2Fimg.png)

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbiuQSx%2FbtqHgqxDrHr%2FM3qSk58KUCGhYYJA7fcSJ1%2Fimg.png)

<br>

## 네이버 세팅

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FDCYaO%2FbtqHoW26x8u%2Fkl5aJhYP6cOmADDL28WHGk%2Fimg.png)

<br>

- 네이버 메일 좌측 하단 환경설정 클릭

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FKdN8F%2FbtqHoXgIGJz%2FXwUJrPhTaKdmnqKsYoTJE0%2Fimg.png)

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FlyS2F%2FbtqHhP4ZV3e%2F6h1QE5Vob5yD2sKWGyAkyK%2Fimg.png)

<br>

## 다음

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcgqsbH%2FbtqHoX10GOl%2FvJHDfSe84go9TbUsvsbpMK%2Fimg.png)

<br>

- 메일 페이지 좌측 하단 환경설정 클릭

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcD9fWW%2FbtqHbYPeKyU%2FkMP6qNqZcMLxS8q9LVtKDk%2Fimg.png)

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbk2kB4%2FbtqHoXgIRU9%2FhEooxcTA9RudZYAj8TtF70%2Fimg.png)

<br>

## pom.xml 설정

```xml
<!-- mail lib -->
		<dependency>
    		<groupId>javax.mail</groupId>
    		<artifactId>mail</artifactId>
    		<version>1.4.7</version>
		</dependency>
```

<br>

- pom.xml에 mail 라이브러리를 추가해준다.

<br>

## spring-context-support 라이브러리를 추가한다.

```xml
<!-- https://mvnrepository.com/artifact/org.springframework/spring-context-support -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context-support</artifactId>
    <version>${org.springframework-version}</version>
</dependency>
```

<br>

## gmail
- root-context.xml 에 코드 추가

<br>

```xml
<!-- gmail설정 -->
<bean id="mailSender2" class="org.springframework.mail.javamail.JavaMailSenderImpl"> 
     <property name="host" value="smtp.gmail.com" />
     <property name="port" value="587" />
 <property name="username" value="your_email"/> <!-- 자신의 이메일 아이디 -->
 <property name="password" value="your_password!"/> <!-- 자신의 비밀번호 -->
 <!-- 보안연결 TLS과 관련된 설정 -->
     <property name="javaMailProperties">
    <props>
       <prop key="mail.smtp.auth">true</prop>
       <prop key="mail.smtp.starttls.enable">true</prop>
    </props>
     </property>
</bean>
```

<br>

## naver
- root-context.xml 에 코드 추가

<br>

```xml
<!-- navermail설정 -->
<bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl"> 
 <property name="host" value="smtp.naver.com"/> <!-- 메이서버 호스트 -->
 <property name="port" value="465"/> <!-- 메이서버 포트번호 -->
 <property name="username" value="your_email"/> <!-- 자신의 이메일 아이디 -->
 <property name="password" value="your_password"/> <!-- 자신의 비밀번호 -->
   <!-- 보안연결 SSL과 관련된 설정 -->
 <property name="javaMailProperties">
  <props>
  <prop key="mail.smtp.auth">true</prop>
  <prop key="mail.smtp.starttls.enable">true</prop>
  <prop key="mail.smtps.checkserveridentity">true</prop>
  <prop key="mail.smtps.ssl.trust">*</prop>
  <prop key="mail.debug">true</prop>
  <prop key="mail.smtp.socketFactory.class">javax.net.ssl.SSLSocketFactory</prop>
  </props>
 </property>
</bean>

```

<br>

- javaMailProperties인 `<property>` 태그에 삽입된 코드는 SSL 인증 코드다.

<br>

## daum
- root-context.xml 에 코드 추가

<br>

```xml
<bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl"> 
 <property name="host" value="smtp.daum.com"/> <!-- 메이서버 호스트 -->
 <property name="port" value="465"/> <!-- 메이서버 포트번호 -->
 <property name="username" value="your_email"/> <!-- 자신의 이메일 아이디 -->
 <property name="password" value="your_password"/> <!-- 자신의 비밀번호 -->
   <!-- 보안연결 SSL과 관련된 설정 -->
 <property name="javaMailProperties">
  <props>
  <prop key="mail.smtp.auth">true</prop>
  <prop key="mail.smtp.starttls.enable">true</prop>
  <prop key="mail.smtps.checkserveridentity">true</prop>
  <prop key="mail.smtps.ssl.trust">*</prop>
  <prop key="mail.debug">true</prop>
  <prop key="mail.smtp.socketFactory.class">javax.net.ssl.SSLSocketFactory</prop>
  </props>
 </property>
</bean>

```